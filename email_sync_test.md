# 邮件同步功能测试指南

## 修复内容

### 1. 完全重新同步机制
- 每次同步时，会从服务器获取所有符合条件的邮件
- 清空本地缓存，重新保存所有邮件
- 保留用户的收藏、笔记、已读状态等操作

### 2. 根据设置同步
- 支持同步数量配置（50/100/200/500封或全部）
- 支持时间范围配置（最近7天/30天/90天/180天或全部时间）
- 根据用户设置决定获取多少邮件

### 3. 用户数据保护
- 在同步前，先提取所有有用户操作的邮件数据
- 合并服务器邮件内容和本地用户数据
- 确保收藏、笔记、AI总结等不会丢失

## 测试步骤

### 测试1：基本同步功能
1. 在设置中配置同步数量（如100封）
2. 清理应用缓存
3. 点击同步按钮
4. 验证是否获取到了设置数量的邮件

### 测试2：用户数据保护
1. 收藏几封邮件，给几封邮件添加笔记
2. 清理应用缓存
3. 重新同步
4. 验证收藏和笔记是否还在

### 测试3：时间范围筛选
1. 在设置中配置时间范围（如最近30天）
2. 同步邮件
3. 验证是否只获取了指定时间范围内的邮件

### 测试4：强制刷新
1. 正常同步一次
2. 使用下拉刷新（强制刷新）
3. 验证是否重新获取了所有邮件

## 预期结果
- 同步后能看到所有符合设置条件的邮件
- 之前的收藏、笔记、已读状态等用户操作得到保留
- 清理缓存后再次同步，能重新获取到之前删除的邮件